<section class="ngx-json-treeview">
  @if (segments().length === 0) {
    <section [class]="'segment-type-' + rootType()">
      <span class="segment-primative">
        {{ json() ?? 'null' }}
      </span>
    </section>
  } @else {
    @if (_currentDepth() === 0) {
      <span class="puctuation">{{ rootType() === 'array' ? '[' : '{' }}</span>
    }
    @for (segment of segments(); track segment; let i = $index) {
      <section [class]="'segment segment-type-' + segment.type">
        @let expandable = isExpandable(segment);
        <section class="segment-main">
          <span
            [class.expandable]="expandable"
            [class.expanded]="segment.expanded"
            (click)="toggle(segment)">
            @if (expandable) {
              <div class="toggler"></div>
            }
            <span class="segment-key">{{ segment.key }}</span>
          </span>
          <span class="puctuation">: </span>
          @if (!expandable || !segment.expanded) {
            <span
              [class]="expandable ? 'segment-label' : 'segment-value'"
              [class.clickable]="
                enableClickableValues() && isClickableValue()(segment)
              "
              (click)="
                isClickableValue()(segment)
                  ? onValueClickHandler(segment)
                  : undefined
              "
              >{{ segment.description }}</span
            >
            <span class="puctuation">{{
              i < segments().length - 1 ? ',' : ''
            }}</span>
          } @else if (expandable && segment.expanded) {
            <span class="puctuation">
              @if (segment.type === 'array') {
                {{ '[' }}
              } @else {
                {{ '{' }}
              }
            </span>
          }
        </section>
        @if (expandable && segment.expanded) {
          <section class="children">
            <ngx-json-treeview
              [json]="segment.value"
              [expanded]="expanded()"
              [depth]="depth()"
              [isClickableValue]="isClickableValue()"
              [enableClickableValues]="enableClickableValues()"
              [_parent]="segment"
              [_currentDepth]="_currentDepth() + 1"
              (onValueClick)="onValueClickHandler($event)" />
            @if (['object', 'array'].includes(segment.type ?? '')) {
              <span class="puctuation">
                @if (segment.type === 'array') {
                  {{ ']' }}
                } @else {
                  {{ '}' }}
                }
              </span>
            }
          </section>
        }
      </section>
    }
    @if (_currentDepth() === 0) {
      <span class="puctuation">{{ rootType() === 'array' ? ']' : '}' }}</span>
    }
  }
</section>
