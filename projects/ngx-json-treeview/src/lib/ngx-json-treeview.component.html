<section class="ngx-json-treeview">
  @if (segments().length === 0) {
    @let sectionClass =
      ['object', 'array'].includes(rootType())
        ? 'punctuation'
        : 'segment-type-' + rootType();
    <section [class]="sectionClass">
      <span class="segment-primative">
        {{ asString() }}
      </span>
    </section>
  } @else {
    @if (_currentDepth() === 0) {
      <span class="puctuation">{{ openingBrace() }}</span>
    }
    @for (
      segment of segments();
      track segment;
      let i = $index;
      let len = $count
    ) {
      <section [class]="'segment segment-type-' + segment.type">
        @let expandable = isExpandable(segment);
        @let empty = isEmpty(segment);
        @let openingBrace = openingBraceForSegment(segment);
        @let closingBrace = closingBraceForSegment(segment);
        @let clickableValue = isClickable(segment);
        <section class="segment-main">
          <span
            [tabindex]="expandable ? 0 : -1"
            [class.expandable]="expandable"
            [class.expanded]="segment.expanded"
            (click)="toggle(segment)"
            (keydown.enter)="toggle(segment)">
            @if (expandable) {
              <div class="toggler"></div>
            }
            <span class="segment-key">{{ `"${segment.key}"` }}</span>
          </span>
          <span class="puctuation">: </span>
          @if (empty) {
            <span
              class="puctuation"
              >{{ `${openingBrace}${closingBrace}${i < len - 1 ? ',' : ''}` }}</span
            >
          } @else if (!expandable || !segment.expanded) {
            <span
              [tabindex]="clickableValue ? 0 : -1"
              [class.segment-label]="expandable"
              [class.segment-value]="!expandable"
              [class.clickable]="clickableValue"
              (click)="onValueClickHandler(segment)"
              (keydown.enter)="onValueClickHandler(segment)"
              >{{ segment.description }}</span
            >
            <span class="puctuation">{{ i < len - 1 ? ',' : '' }}</span>
          } @else {
            @if (openingBrace) {
              <span class="puctuation">
                {{ openingBrace }}
              </span>
            }
          }
        </section>
        @if (expandable && segment.expanded) {
          <section class="children">
            <ngx-json-treeview
              [json]="segment.value"
              [expanded]="expanded()"
              [depth]="depth()"
              [isClickableValue]="isClickableValue()"
              [enableClickableValues]="enableClickableValues()"
              [_parent]="segment"
              [_currentDepth]="_currentDepth() + 1"
              (onValueClick)="onValueClickHandler($event)" />
            @if (closingBrace) {
              <span class="puctuation"
                >{{ closingBrace }}{{ i < len - 1 ? ',' : '' }}</span
              >
            }
          </section>
        }
      </section>
    }
    @if (_currentDepth() === 0) {
      <span class="puctuation">{{ closingBrace() }}</span>
    }
  }
</section>
